#!/usr/bin/env ruby

require 'json'
require 'tins/xt'
require 'tins/go'
include Tins::GO

opt = go 'c'
if opt['c']
  brakeman = `bundle exec which brakeman`.full? or fail "cannot find brakeman in path"
  system *%w'bundle exec brakeman -q -o .brakeman.json' or fail "calling brakeman failed"
else
  results = JSON File.read('.brakeman.json'), object_class: JSON::GenericObject
  for error in results.errors
    puts error.location, "Error #{error.error.inspect}"
  end
  for warning in results.warnings
    puts "#{warning.file}:#{warning.line}",
         "#{warning.warning_type} (#{warning.confidence}) #{warning.message.inspect}",
         warning.code
  end
end
