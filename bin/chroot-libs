#!/usr/bin/env ruby

require 'fileutils'
include FileUtils::Verbose

msg = "Usage: #$0 EXECUTABLE DIR [LIB ..]"
executable = ARGV.shift or fail msg
dir = ARGV.shift or fail msg
dir = File.expand_path dir
mkdir_p dir

unless executable.start_with? '/'
  executable = `which #{executable}`.chomp
end
libs = `ldd #{executable}`.gsub(/^(?:.*?\s+=>\s+|\s+)(.*?)\(.*/, '\1').grep(/\S/).map { |x| x.strip }
libs.concat ARGV
cd dir do
  cp executable, File.basename(executable)
  for l in libs
    cp l, File.basename(l)
  end
end
