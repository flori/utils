#!/usr/bin/env ruby
#
# Launch simple HTTP server for a local directory

require 'tins/go'
include Tins::GO
require 'webrick'

$opts = go 'b:p:h', defaults: { ?b => '127.0.0.1', ?p => 8888 }

if $opts[?h]
  puts <<~USAGE
    #{File.basename($0)} - Launch simple HTTP server for a local directory
    
    Usage: #{File.basename($0)} [OPTIONS] [DIR]
    
    Options:
      -b ADDRESS  Address to bind to  (default: "127.0.0.1")
      -p PORT     Specify port number (default: 8888)
      -h          Show this help message
    
    Examples:
      #{File.basename($0)}                    # Serve current directory on 127.0.0.1:8888
      #{File.basename($0)} -b 0.0.0.0         # Serve on 0.0.0.0:3000
      #{File.basename($0)} -p 3000            # Serve on 127.0.0.1:3000
      #{File.basename($0)} /path/to/dir       # Serve specific directory
    
    Note: If no directory is specified, serves the current working directory.
  USAGE
  exit
end

address = $opts[?b]
port    = $opts[?p].to_i
s = WEBrick::HTTPServer.new(
  BindAddress:  address,
  Port:         port,
  DocumentRoot: ARGV.shift || Dir.pwd
)
trap('INT') { s.shutdown }
puts "You have been served: http://#{address}:#{port}/"
s.start
